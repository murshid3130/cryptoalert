<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Crypto Sentinel - Multi-Timeframe</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0e11; color: #eaecef; margin: 0; padding: 15px; }
        .container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .card { background: #1e2329; border-radius: 12px; padding: 15px; border: 1px solid #333; min-width: 300px; flex: 1; }
        
        /* Chart Styling */
        #chart-container { height: 500px; width: 100%; margin-top: 15px; border-radius: 12px; overflow: hidden; border: 1px solid #333; }

        /* Search & Filters */
        .controls-bar { margin-bottom: 20px; text-align: center; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        select, input { background: #2b3139; color: white; border: 1px solid #474d57; padding: 10px; border-radius: 5px; outline: none; }
        button { background: #f0b90b; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #d3a108; }

        .price-display { font-size: 2.2rem; color: #f0b90b; margin: 10px 0; font-weight: bold; }
        .buy-signal { color: #02c076; font-weight: bold; background: rgba(2, 192, 118, 0.1); padding: 5px; border-radius: 4px; }
        .sell-signal { color: #cf304a; font-weight: bold; background: rgba(207, 48, 74, 0.1); padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="controls-bar">
        <select id="coin-selector" onchange="updateDashboard()">
            <option value="ethereum">Loading Coins...</option>
        </select>

        <select id="timeframe-selector" onchange="updateDashboard()">
            <option value="15">15 Minutes (Scalping)</option>
            <option value="60" selected>1 Hour (Day Trade)</option>
            <option value="240">4 Hours (Swing)</option>
            <option value="D">1 Day (Long Term)</option>
        </select>

        <input type="number" id="alert-price" placeholder="Target Price ($)">
        <button onclick="setAlert()">Set Alert</button>
    </div>

    <div class="container">
        <div class="card">
            <h3>Live: <span id="coin-name">Ethereum</span></h3>
            <div class="price-display" id="live-price">$0.00</div>
            <div id="price-change">--% (24h)</div>
            <div id="signal-advice" style="margin-top: 12px;">Analyzing...</div>
        </div>

        <div class="card">
            <h3>Market Sentiment</h3>
            <p>Fear & Greed Index: <strong id="fgi-val" style="color:#00ffcc;">--</strong></p>
            <hr style="border:0.5px solid #333;">
            <div id="active-alerts" style="font-size: 0.85rem; color: #848e9c;">No active alerts</div>
        </div>
    </div>

    <div id="chart-container">
        <div id="tradingview_widget" style="height: 100%;"></div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let currentSymbol = 'ETHUSDT';
        let currentID = 'ethereum';
        let currentTF = '60';
        let alerts = [];

        // 1. Fetch Top 300 Coins
        async function fetchCoins() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=300&page=1');
                const coins = await res.json();
                const selector = document.getElementById('coin-selector');
                selector.innerHTML = '';
                coins.forEach(coin => {
                    let opt = document.createElement('option');
                    opt.value = coin.id;
                    opt.dataset.symbol = coin.symbol.toUpperCase() + 'USDT';
                    opt.innerText = `${coin.name} (${coin.symbol.toUpperCase()})`;
                    if(coin.id === 'ethereum') opt.selected = true;
                    selector.appendChild(opt);
                });
            } catch (e) { console.error("Coin fetch failed"); }
        }

        // 2. Main Update Function
        function updateDashboard() {
            const coinSel = document.getElementById('coin-selector');
            const tfSel = document.getElementById('timeframe-selector');
            
            const selectedCoin = coinSel.options[coinSel.selectedIndex];
            currentID = selectedCoin.value;
            currentSymbol = selectedCoin.dataset.symbol;
            currentTF = tfSel.value;
            
            document.getElementById('coin-name').innerText = selectedCoin.innerText;
            
            loadChart(currentSymbol, currentTF);
            fetchPrice();
        }

        // 3. Load Chart with Timeframe
        function loadChart(symbol, interval) {
            new TradingView.widget({
                "autosize": true,
                "symbol": "BINANCE:" + symbol,
                "interval": interval,
                "timezone": "Etc/UTC",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "container_id": "tradingview_widget"
            });
        }

        // 4. Price & Signal Logic
        async function fetchPrice() {
            try {
                const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${currentID}&vs_currencies=usd&include_24hr_change=true`);
                const data = await res.json();
                const price = data[currentID].usd;
                const change = data[currentID].usd_24h_change;

                document.getElementById('live-price').innerText = `$${price.toLocaleString()}`;
                const changeEl = document.getElementById('price-change');
                changeEl.innerText = `${change.toFixed(2)}% (24h)`;
                changeEl.style.color = change >= 0 ? '#02c076' : '#cf304a';

                // Simple Logic for Advice
                const adv = document.getElementById('signal-advice');
                if (change < -4) {
                    adv.innerHTML = `<span class="buy-signal">BUY ADVICE: Heavy Dip</span>`;
                } else if (change > 6) {
                    adv.innerHTML = `<span class="sell-signal">SELL ADVICE: Overbought</span>`;
                } else {
                    adv.innerHTML = `<span style="color:#848e9c">NEUTRAL: Side-ways movement</span>`;
                }

                // Check Alerts
                alerts.forEach((a, i) => {
                    if (price >= a) {
                        alert(`ðŸŽ¯ TARGET REACHED: ${currentID.toUpperCase()} is $${price}`);
                        alerts.splice(i, 1);
                        renderAlerts();
                    }
                });
            } catch (e) { console.log("Price update error"); }
        }

        function setAlert() {
            const val = document.getElementById('alert-price').value;
            if(val) {
                alerts.push(parseFloat(val));
                renderAlerts();
                document.getElementById('alert-price').value = '';
            }
        }

        function renderAlerts() {
            const div = document.getElementById('active-alerts');
            div.innerHTML = alerts.length ? alerts.map(a => `<div>ðŸ”” Alert at $${a}</div>`).join('') : 'No active alerts';
        }

        async function fetchFGI() {
            const res = await fetch('https://api.alternative.me/fng/');
            const d = await res.json();
            document.getElementById('fgi-val').innerText = `${d.data[0].value} (${d.data[0].value_classification})`;
        }

        // Init
        fetchCoins().then(() => {
            updateDashboard();
            fetchFGI();
            setInterval(fetchPrice, 15000);
        });
    </script>
</body>
</html>
