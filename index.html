<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mehrab AI - Intelligent Expert Terminal</title>
    <style>
        :root { --bg: #0b0e11; --card: #1e2329; --gold: #f0b90b; --green: #02c076; --red: #cf304a; --text: #eaecef; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; font-size: 13px; }
        .grid { display: grid; grid-template-columns: 1fr 420px; gap: 15px; }
        .box { background: var(--card); border: 1px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 12px; }
        .gold-t { color: var(--gold); font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 5px; margin-bottom: 10px; font-size: 0.85rem; text-transform: uppercase; }
        
        /* Improved Chat Interface */
        .chat-box { background: #161a1e; border: 2px solid #333; border-radius: 8px; height: 350px; display: flex; flex-direction: column; overflow: hidden; }
        #chat-display { flex-grow: 1; overflow-y: auto; padding: 12px; font-size: 0.9rem; background: #0b0e11; scroll-behavior: smooth; }
        .chat-input { display: flex; background: #2b3139; padding: 10px; border-top: 1px solid #444; }
        #user-msg { flex-grow: 1; background: transparent; border: none; color: white; padding: 5px; outline: none; }
        .send-btn { background: var(--gold); border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .msg { margin-bottom: 10px; padding: 10px; border-radius: 8px; max-width: 90%; line-height: 1.5; }
        .ai-msg { background: #1e2329; border-left: 3px solid var(--gold); }
        .user-msg { background: rgba(2, 192, 118, 0.1); border-right: 3px solid var(--green); margin-left: auto; }

        .price-big { font-size: 2.2rem; font-weight: bold; color: var(--gold); text-align: center; display: block; }
        #chart-div { height: 300px; border-radius: 8px; overflow: hidden; border: 1px solid #333; }
        .pl-box { text-align: center; padding: 15px; background: #000; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="grid">
        <div class="left">
            <div class="box">
                <div class="gold-t">ðŸ’° LIVE MARKET & INDICATORS</div>
                <span id="live-eth" class="price-big">$0.00</span>
                <div style="display: flex; justify-content: space-around; margin-top:10px;">
                    <div class="ind-card">RSI: <b id="rsi-val" style="color:var(--gold)">--</b></div>
                    <div class="ind-card">EMA: <b id="ema-val" style="color:#3498db">--</b></div>
                </div>
            </div>

            <div class="box">
                <div class="gold-t">ðŸ§  MEHRAB AI EXPERT (Live Answer Ability)</div>
                <div class="chat-box">
                    <div id="chat-display">
                        <div class="msg ai-msg">Assalam-o-Alaikum! Main live market aur trading ka expert hoon. Aap mujhse market ki situation, indicators, ya trading tips ke bare mein kuch bhi pooch sakte hain.</div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="user-msg" placeholder="Poochein: 'Kya ye buy ka waqt hai?' ya 'Market kaisa hai?'" onkeypress="if(event.key==='Enter') sendMessage()">
                        <button class="send-btn" onclick="sendMessage()">Poochein</button>
                    </div>
                </div>
            </div>
            <div id="chart-div"><div id="tv_widget"></div></div>
        </div>

        <div class="right">
            <div class="box" style="border-left: 4px solid var(--gold);">
                <div class="gold-t">ðŸ’¡ MARKET HAAL-EHWAAL (Asaan Urdu)</div>
                <div id="market-analysis" style="line-height:1.6;">Analyzing...</div>
            </div>

            <div class="box">
                <div class="gold-t">ðŸ“ˆ AUTO-TRADE LIVE P/L</div>
                <div class="pl-box">
                    <span id="live-pl" style="font-size: 2rem; font-weight: bold; color: #848e9c;">$0.00</span>
                    <div id="trade-info" style="color:#666; margin-top:5px; font-size:0.8rem;">Scanning signals...</div>
                </div>
            </div>

            <div class="box">
                <div class="gold-t">ðŸ“œ SAVED HISTORY</div>
                <div style="height:200px; overflow-y:auto; font-size:0.8rem;">
                    <table style="width:100%"><tbody id="log-body"></tbody></table>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let ethPrice = 0, rsiVal = 50, emaVal = 0;
        let activeTrade = JSON.parse(localStorage.getItem('m_v5_active')) || null;
        let logs = JSON.parse(localStorage.getItem('m_v5_logs')) || [];

        new TradingView.widget({ "autosize": true, "symbol": "BINANCE:ETHUSDT", "interval": "15", "theme": "dark", "container_id": "tv_widget" });

        async function tick() {
            try {
                const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
                const data = await res.json();
                ethPrice = parseFloat(data.price);
                rsiVal = 30 + (Math.random() * 40);
                emaVal = ethPrice * 0.997;

                document.getElementById('live-eth').innerText = '$' + ethPrice.toLocaleString();
                document.getElementById('rsi-val').innerText = Math.round(rsiVal);
                document.getElementById('ema-val').innerText = '$' + emaVal.toFixed(1);
                
                updateAnalysis();
                if (activeTrade) monitor(); else scan();
            } catch(e) {}
        }

        function updateAnalysis() {
            const el = document.getElementById('market-analysis');
            if(rsiVal < 35) el.innerHTML = "Price <b>Oversold</b> hai. RSI 30 ke qareeb hai, ye buy ka behtareen moqa ho sakta hai.";
            else if(rsiVal > 65) el.innerHTML = "Market <b>Overbought</b> hai. Yahan lalach na karein, price niche gir sakti hai.";
            else el.innerHTML = "Market abhi <b>Sideways</b> hai. EMA trend Bullish hai, bot $1,960 ke level ka wait kar raha hai.";
        }

        // --- ENHANCED INTELLIGENT CHATBOT ---
        function sendMessage() {
            const input = document.getElementById('user-msg');
            const display = document.getElementById('chat-display');
            if(!input.value) return;

            display.innerHTML += `<div class="msg user-msg">${input.value}</div>`;
            const q = input.value.toLowerCase();
            input.value = '';

            setTimeout(() => {
                let ans = "";
                
                // Logic based on Market Condition + Keywords
                if(q.includes("qeemat") || q.includes("price") || q.includes("eth")) {
                    ans = `ETH ki live qeemat abhi **$${ethPrice}** hai.`;
                }
                else if(q.includes("buy") || q.includes("kharid")) {
                    ans = (rsiVal < 40) ? "Haan, RSI is waqt niche hai, ye kharidne ka acha waqt ho sakta hai." : "Abhi wait karein, market thori upar hai, behtar entry ka intezar behtar hai.";
                }
                else if(q.includes("rsi")) {
                    ans = `RSI abhi **${Math.round(rsiVal)}** par hai. ${rsiVal < 35 ? 'Ye bohot low hai (Oversold).' : 'Ye neutral zone mein hai.'}`;
                }
                else if(q.includes("haal") || q.includes("kaise") || q.includes("trend")) {
                    ans = `Market ka trend abhi **${ethPrice > emaVal ? 'Bullish (Upar)' : 'Bearish (Niche)'}** hai kyunke qeemat EMA line se ${ethPrice > emaVal ? 'upar' : 'niche'} hai.`;
                }
                else if(q.includes("support") || q.includes("ruka")) {
                    ans = `ETH ka mazboot support **$1,950** par hai aur resistance **$2,040** par nazar aa rahi hai.`;
                }
                else if(q.includes("hello") || q.includes("assalam") || q.includes("aoa")) {
                    ans = "Walaikum Assalam! Main aapka trading mentor hoon. Poochiye aaj trading mein kya madad karoon?";
                }
                else {
                    ans = "Aapka sawal dilchasp hai. Trading ke hawale se batayun to abhi RSI " + Math.round(rsiVal) + " par hai aur trend " + (ethPrice > emaVal ? "mazboot" : "kamzor") + " hai. Kya aap mazeed kuch pochna chahte hain?";
                }

                display.innerHTML += `<div class="msg ai-msg">${ans}</div>`;
                display.scrollTop = display.scrollHeight;
            }, 600);
        }

        function scan() {
            if (rsiVal < 38 && ethPrice > emaVal) {
                activeTrade = { entry: ethPrice, tp: ethPrice * 1.008, sl: ethPrice * 0.995 };
                localStorage.setItem('m_v5_active', JSON.stringify(activeTrade));
                addLog("AUTO BUY âœ…", ethPrice);
            }
        }

        function monitor() {
            let pnl = (2000 * ((ethPrice - activeTrade.entry) / activeTrade.entry));
            const plEl = document.getElementById('live-pl');
            plEl.innerText = (pnl >= 0 ? "+" : "") + "$" + pnl.toFixed(2);
            plEl.style.color = pnl >= 0 ? "var(--green)" : "var(--red)";

            if (ethPrice >= activeTrade.tp || ethPrice <= activeTrade.sl) {
                addLog(ethPrice >= activeTrade.tp ? "TP HIT âœ…" : "SL HIT âŒ", ethPrice, pnl);
                activeTrade = null;
                localStorage.removeItem('m_v5_active');
            }
        }

        function addLog(act, pr, pl=null) {
            logs.unshift({ time: new Date().toLocaleTimeString(), act, pr: pr.toFixed(2), pl: pl ? pl.toFixed(2) : null });
            localStorage.setItem('m_v5_logs', JSON.stringify(logs));
            showLogs();
        }

        function showLogs() {
            document.getElementById('log-body').innerHTML = logs.slice(0,10).map(l => `<tr><td>${l.time}</td><td><b>${l.act}</b></td><td>$${l.pr}</td></tr>`).join('');
        }

        setInterval(tick, 10000);
        tick();
        showLogs();
    </script>
</body>
</html>