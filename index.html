<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mehrab AI - Autonomous Paper Trader</title>
    <style>
        :root { --bg: #0b0e11; --card: #1e2329; --gold: #f0b90b; --green: #02c076; --red: #cf304a; --text: #eaecef; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; font-size: 13px; }
        
        /* Header & Tabs */
        .header-box { text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 5px; margin-bottom: 10px; }
        .branding { color: var(--gold); font-weight: bold; font-size: 1.1rem; text-transform: uppercase; margin: 0; }
        .tab-group { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { flex: 1; padding: 10px; background: #2b3139; border: 1px solid #444; color: #848e9c; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .tab-btn.active { background: var(--gold); color: black; }

        /* Status Bar */
        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .stat-card { background: #2b3139; padding: 8px; border-radius: 6px; text-align: center; border: 1px solid #444; }
        .val { display: block; font-weight: bold; color: var(--gold); font-size: 1rem; }

        /* Trading Engine Display */
        .engine-panel { background: #1c2127; border: 1px solid var(--gold); border-radius: 8px; padding: 15px; margin-bottom: 10px; }
        .target-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; margin-top: 10px; }
        .price-tag { font-size: 1.2rem; font-weight: bold; display: block; margin-top: 4px; }
        
        .bot-status { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; font-weight: bold; }
        .pulse { width: 10px; height: 10px; background: var(--green); border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(0.9); opacity: 0.7; } 70% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(0.9); opacity: 0.7; } }

        /* Logs & Tables */
        .history-box { background: #161a1e; border-radius: 8px; padding: 10px; height: 250px; overflow-y: auto; border: 1px solid #444; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        th { color: #848e9c; border-bottom: 1px solid #333; padding-bottom: 5px; text-align: left; }
        td { padding: 8px 0; border-bottom: 1px solid #222; }
        
        .btn-action { width: 100%; padding: 10px; margin-top: 10px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }
        .bullish { color: var(--green); } .bearish { color: var(--red); }
    </style>
</head>
<body>

    <div class="header-box"><h1 class="branding">Mehrab AI - Paper Trading Bot</h1></div>

    <div class="stats-bar">
        <div class="stat-card"><span style="font-size:0.7rem; color:#848e9c;">Paper Balance</span><span id="balance" class="val">$10,000</span></div>
        <div class="stat-card"><span style="font-size:0.7rem; color:#848e9c;">ETH Price</span><span id="live-eth" class="val">--</span></div>
        <div class="stat-card"><span style="font-size:0.7rem; color:#848e9c;">Total Profit</span><span id="total-pl" class="val">$0.00</span></div>
    </div>

    <div class="engine-panel">
        <div class="bot-status">
            <div class="pulse"></div> 
            <span id="bot-mode-text">BOT ACTIVE: MUSALSAL TRADING...</span>
        </div>
        
        <div style="text-align:center; font-size:0.8rem; color:#848e9c;">Current Logic: <strong id="profile-name" style="color:var(--gold)">Normal</strong></div>
        
        <div class="target-grid">
            <div><span style="font-size:0.6rem; color:#848e9c;">ENTRY</span><span id="fig-entry" class="price-tag">--</span></div>
            <div><span style="font-size:0.6rem; color:var(--green);">TAKE PROFIT</span><span id="fig-tp" class="price-tag" style="color:var(--green);">--</span></div>
            <div><span style="font-size:0.6rem; color:var(--red);">STOP LOSS</span><span id="fig-sl" class="price-tag" style="color:var(--red);">--</span></div>
        </div>

        <div style="display:flex; gap:10px; margin-top:15px;">
            <button onclick="changeProfile('normal')" class="tab-btn active" id="btn-normal">Normal</button>
            <button onclick="changeProfile('intermediate')" class="tab-btn" id="btn-inter">Intermediate</button>
            <button onclick="changeProfile('aggressive')" class="tab-btn" id="btn-agg">Aggressive</button>
        </div>
    </div>

    <div class="history-box">
        <div style="color:var(--gold); font-weight:bold; margin-bottom:10px; display:flex; justify-content:space-between;">
            <span>ðŸ“‹ LIVE PAPER TRADE LOGS</span>
            <span id="trade-count" style="color:#848e9c;">Trades: 0</span>
        </div>
        <table>
            <thead><tr><th>Time</th><th>Profile</th><th>Type</th><th>Price</th><th>P/L</th></tr></thead>
            <tbody id="log-body"></tbody>
        </table>
    </div>

    <script>
        // Trading State
        let balance = parseFloat(localStorage.getItem('p_balance')) || 10000;
        let totalPL = parseFloat(localStorage.getItem('p_totalPL')) || 0;
        let trades = JSON.parse(localStorage.getItem('p_trades')) || [];
        let activePosition = JSON.parse(localStorage.getItem('p_active')) || null;
        
        const profiles = {
            normal: { tp: 0.8, sl: 0.4, name: "Normal" },
            intermediate: { tp: 1.5, sl: 0.7, name: "Intermediate" },
            aggressive: { tp: 3.0, sl: 1.2, name: "Aggressive" }
        };
        let currentProfile = profiles.normal;

        async function tick() {
            try {
                const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT');
                const data = await res.json();
                const price = parseFloat(data.price);
                
                document.getElementById('live-eth').innerText = '$' + price.toFixed(2);
                updateTargets(price);

                if (activePosition) {
                    monitorPosition(price);
                } else {
                    scanForEntry(price);
                }
                updateUI();
            } catch (e) { console.error("Price fetch failed"); }
        }

        function updateTargets(price) {
            document.getElementById('fig-entry').innerText = '$' + price.toFixed(2);
            const tp = price * (1 + currentProfile.tp/100);
            const sl = price * (1 - currentProfile.sl/100);
            document.getElementById('fig-tp').innerText = '$' + tp.toFixed(2);
            document.getElementById('fig-sl').innerText = '$' + sl.toFixed(2);
        }

        function scanForEntry(price) {
            // Paper Trading Logic: Simulating a 5% chance of finding a setup every tick (15s)
            // In real use, this would check RSI/EMA confluences
            if (Math.random() > 0.92) { 
                const side = Math.random() > 0.5 ? "BUY" : "SELL";
                activePosition = {
                    type: side,
                    entry: price,
                    tp: side === "BUY" ? price * (1 + currentProfile.tp/100) : price * (1 - currentProfile.tp/100),
                    sl: side === "BUY" ? price * (1 - currentProfile.sl/100) : price * (1 + currentProfile.sl/100),
                    profile: currentProfile.name,
                    amount: 2000, // Fixed position size $2000
                    startTime: new Date().toLocaleTimeString()
                };
                localStorage.setItem('p_active', JSON.stringify(activePosition));
                addLog(activePosition.startTime, currentProfile.name, side, price, "OPENING...");
            }
        }

        function monitorPosition(price) {
            let pnlPerc = ((price - activePosition.entry) / activePosition.entry) * 100;
            if (activePosition.type === "SELL") pnlPerc = -pnlPerc;

            let closed = false;
            // Check TP or SL hit
            if (activePosition.type === "BUY") {
                if (price >= activePosition.tp || price <= activePosition.sl) closed = true;
            } else {
                if (price <= activePosition.tp || price >= activePosition.sl) closed = true;
            }

            if (closed) {
                const profit = (activePosition.amount * pnlPerc) / 100;
                balance += profit;
                totalPL += profit;
                
                trades.unshift({
                    time: new Date().toLocaleTimeString(),
                    profile: activePosition.profile,
                    type: activePosition.type,
                    price: price,
                    pnl: profit
                });

                activePosition = null;
                localStorage.removeItem('p_active');
                saveAll();
                renderLogs();
            }
        }

        function changeProfile(id) {
            currentProfile = profiles[id];
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + (id==='normal'?'normal':id==='intermediate'?'inter':'agg')).classList.add('active');
            document.getElementById('profile-name').innerText = currentProfile.name;
        }

        function addLog(time, profile, type, price, pnl) {
            const row = `<tr><td>${time}</td><td>${profile}</td><td class="${type==='BUY'?'bullish':'bearish'}">${type}</td><td>$${price.toFixed(1)}</td><td class="bullish">${pnl}</td></tr>`;
            document.getElementById('log-body').insertAdjacentHTML('afterbegin', row);
        }

        function renderLogs() {
            document.getElementById('log-body').innerHTML = trades.slice(0, 20).map(t => `
                <tr>
                    <td>${t.time}</td>
                    <td>${t.profile}</td>
                    <td class="${t.type==='BUY'?'bullish':'bearish'}">${t.type}</td>
                    <td>$${t.price.toFixed(1)}</td>
                    <td class="${t.pnl >= 0 ? 'bullish' : 'bearish'}">${t.pnl >= 0 ? '+' : ''}${t.pnl.toFixed(2)}</td>
                </tr>
            `).join('');
            document.getElementById('trade-count').innerText = `Trades: ${trades.length}`;
        }

        function updateUI() {
            document.getElementById('balance').innerText = `$${balance.toFixed(0)}`;
            document.getElementById('total-pl').innerText = `$${totalPL.toFixed(2)}`;
            document.getElementById('total-pl').style.color = totalPL >= 0 ? 'var(--green)' : 'var(--red)';
        }

        function saveAll() {
            localStorage.setItem('p_balance', balance);
            localStorage.setItem('p_totalPL', totalPL);
            localStorage.setItem('p_trades', JSON.stringify(trades));
        }

        // Start Bot
        setInterval(tick, 15000); 
        tick();
        renderLogs();
    </script>
</body>
</html>