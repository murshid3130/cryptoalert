<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mehrab AI - Complete Trading Hub</title>
    <style>
        :root { --bg: #0b0e11; --card: #1e2329; --gold: #f0b90b; --green: #02c076; --red: #cf304a; --text: #eaecef; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        
        .branding { text-align: center; color: var(--gold); font-weight: bold; margin-bottom: 5px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        /* Easy AI Decoder Section */
        .decoder-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        .decoder-card { background: #1c2127; border-left: 4px solid var(--gold); padding: 10px; border-radius: 6px; font-size: 0.85rem; }
        .decoder-title { font-weight: bold; color: var(--gold); font-size: 0.8rem; margin-bottom: 4px; }
        .easy-text { color: #fff; line-height: 1.3; }

        /* Forecast Section (Old Settings) */
        .forecast-card { background: var(--card); border: 1px solid #444; border-radius: 8px; padding: 12px; margin-bottom: 10px; }
        .forecast-row { display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.85rem; font-weight: bold; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-bottom: 10px; }
        .card { background: var(--card); border-radius: 8px; padding: 12px; border: 1px solid #333; }
        .price-val { font-size: 1.8rem; color: var(--gold); font-weight: bold; }
        
        #chart-container { height: 300px; border-radius: 8px; overflow: hidden; border: 1px solid #333; }
        .controls { display: flex; gap: 5px; justify-content: center; margin-bottom: 10px; }
        select, button { padding: 6px 10px; border-radius: 4px; border: none; background: #2b3139; color: white; cursor: pointer; font-size: 0.8rem; }
        button { background: var(--gold); color: black; font-weight: bold; }
    </style>
</head>
<body>

    <div class="branding">Mehrab Ali - AI Smart Terminal</div>

    <div class="decoder-grid">
        <div class="decoder-card">
            <div class="decoder-title">üïØÔ∏è Candle Kya Keh Rahi Hai?</div>
            <div id="candle-easy" class="easy-text">Checking market mood...</div>
        </div>
        <div class="decoder-card">
            <div class="decoder-title">üìä Indicators Ka Ishara</div>
            <div id="ind-easy" class="easy-text">Checking trend strength...</div>
        </div>
    </div>

    <div class="forecast-card">
        <div style="color:var(--gold); font-weight:bold; border-bottom:1px solid #333; padding-bottom:3px;">üìà AI TRADE SETUP (H1)</div>
        <div class="forecast-row">
            <div style="color:var(--green)">ENTRY: <span id="entry-p">--</span></div>
            <div style="color:var(--red)">SL: <span id="sl-p">--</span></div>
            <div style="color:var(--gold)">TP: <span id="tp-p">--</span></div>
        </div>
    </div>

    <div class="controls">
        <select id="coin-selector" onchange="initUpdate()"></select>
        <select id="tf-selector" onchange="initUpdate()">
            <option value="15">15m</option>
            <option value="60" selected>1h</option>
            <option value="D">1D</option>
        </select>
        <button onclick="fetchData()">üîÑ Sync</button>
    </div>

    <div class="grid">
        <div class="card">
            <h3 id="display-name" style="margin:0; font-size: 0.85rem;">Coin</h3>
            <div class="price-val" id="live-price">$0.00</div>
        </div>
        <div class="card" style="display:flex; flex-direction:column; justify-content:center;">
            <div style="display:flex; justify-content:space-between;">
                <span>Res: <b id="r1" style="color:var(--red)">--</b></span>
                <span>Sup: <b id="s1" style="color:var(--green)">--</b></span>
            </div>
        </div>
    </div>

    <div id="chart-container"><div id="tv-widget" style="height: 100%;"></div></div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let currentID = 'bitcoin', currentPrice = 0;

        async function getCoins() {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=30');
            const data = await res.json();
            const sel = document.getElementById('coin-selector');
            data.forEach(c => {
                let opt = document.createElement('option');
                opt.value = c.id; opt.dataset.symbol = c.symbol.toUpperCase() + 'USDT';
                opt.innerText = c.name; if(c.id === 'bitcoin') opt.selected = true;
                sel.appendChild(opt);
            });
            initUpdate();
        }

        function initUpdate() {
            const sel = document.getElementById('coin-selector');
            const sym = sel.options[sel.selectedIndex].dataset.symbol;
            currentID = sel.value;
            document.getElementById('display-name').innerText = sel.options[sel.selectedIndex].text;
            
            new TradingView.widget({
                "autosize": true, "symbol": "BINANCE:"+sym, "interval": document.getElementById('tf-selector').value,
                "theme": "dark", "container_id": "tv-widget", "studies": ["RSI@tv-basicstudies"]
            });
            fetchData();
        }

        async function fetchData() {
            try {
                const res = await fetch(`https://api.coingecko.com/api/v3/coins/${currentID}/ohlc?vs_currency=usd&days=1`);
                const ohlc = await res.json();
                const last = ohlc[ohlc.length - 1]; 
                const open = last[1], high = last[2], low = last[3], close = last[4];
                
                document.getElementById('live-price').innerText = '$' + close.toLocaleString();

                // --- ASAN CANDLE DECODER LOGIC ---
                let candleText = "";
                const body = Math.abs(close - open);
                const uWick = high - Math.max(open, close);
                const lWick = Math.min(open, close) - low;

                if (lWick > body * 2) {
                    candleText = "Niche se rejection hai! Matlab buyers zor laga rahe hain, price upar ja sakti hai (Bullish).";
                } else if (uWick > body * 2) {
                    candleText = "Upar se thappa laga hai! Sellers ne price niche girayi hai, thora sambhal kar (Bearish).";
                } else if (close > open && body > (high-low)*0.7) {
                    candleText = "Full Green power! Market mein tezi hai, buyers full control mein hain.";
                } else {
                    candleText = "Market confuse hai (Doji). Abhi koi barha move nahi dikh raha, wait karein.";
                }
                document.getElementById('candle-easy').innerText = candleText;

                // --- ASAN INDICATOR LOGIC ---
                const pivot = (high + low + close) / 3;
                const r1 = (2*pivot)-low;
                const s1 = (2*pivot)-high;
                document.getElementById('r1').innerText = r1.toFixed(2);
                document.getElementById('s1').innerText = s1.toFixed(2);

                let indText = (close > pivot) ? "Trend Upar ka hai (Positive). Support se buy karna behtar hai." : "Trend Niche ka hai (Negative). Resistance par sell ka moka dekhein.";
                document.getElementById('ind-easy').innerText = indText;

                // --- FORECAST (ENTRY/SL/TP) ---
                document.getElementById('entry-p').innerText = (r1 * 1.002).toFixed(2);
                document.getElementById('sl-p').innerText = (s1 * 0.995).toFixed(2);
                document.getElementById('tp-p').innerText = (r1 * 1.05).toFixed(2);

            } catch(e) { console.log("Updating..."); }
        }

        getCoins();
        setInterval(fetchData, 30000);
    </script>
</body>
</html>